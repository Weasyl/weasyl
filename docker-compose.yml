version: '2'
services:

  cache:
    image: memcached

  db:
    build:
      context: ./docker
      dockerfile: postgres-dev.docker
    image: postgres-weasyl-dev

  weasyl-app-dev:
    build:
      context: .
      dockerfile: docker/weasyl-app-dev.docker
    image: weasyl-app-dev

    command: run
    volumes:
      - .:/weasyl-src
      - ./config:/weasyl-app/config
      - ./static:/weasyl-app/static
      - ws_character:/weasyl-app/static/character
      - ws_journal:/weasyl-app/static/journal
      - ws_media:/weasyl-app/static/media
    depends_on:
      - cache
      - db

  nginx:
    build:
      context: ./docker
      dockerfile: nginx-dev.docker
    image: nginx-weasyl-dev

    volumes:
      - ./static:/weasyl-app/static
      - ws_character:/weasyl-app/static/character
      - ws_journal:/weasyl-app/static/journal
      - ws_media:/weasyl-app/static/media
    depends_on:
      - weasyl-app-dev
    ports:
      - '80'

volumes:
  ws_character: {}
  ws_journal: {}
  ws_media: {}
