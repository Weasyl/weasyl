$def with (tfa_secret, tfa_recovery_codes, error)
$:{RENDER("common/stage_title.html", ["Enable 2FA: Step 3", "Two-Factor Authentication", "/control/2fa/status"])}

<div class="content form clear">
  <form method="POST" class="form skinny clear" action="/control/2fa/init_verify">
    $if error == "2fa":
      <div id="signin_error">
        <strong>Whoops!</strong> The 2FA response token you provided did not validate.
      </div>
    $elif error == "verify":
      <div id="signin_error">
        <strong>Hey!</strong> Did you want to enable 2FA? You didn't check the verification checkbox!
      </div>

    <h3>Verify Receipt of Two-Factor Authentication (2FA) Recovery Codes</h3>
    <p>
      <strong>Print these codes, and secure them as you would your password.</strong>
      In the event you lose access to your authenticator app, you will need these
      codes to regain access to your Weasyl account. Recovery codes can be
      refreshed at any time from your settings page.
    </p>
    <p>
      <strong>Warning:</strong> For security reasons, Weasyl staff will be unable to assist you if
      you lose access to your recovery codes. We advise never using more than eight codes, as you will
      need two to disable 2FA from a logged-out state (one code to log in, and one code to disable
      two-factor authentication).
      <br />
      As a precaution against being locked out your account if all recovery codes are used, 2FA will
      automatically be disabled if--and only if--all recovery codes are consumed during the login process.
      Generating a new set of codes will prevent this from occurring. If this occurs, you will need
      to set-up 2FA again.
    </p>
    <h3>Your recovery codes are...</h3>
    <ol>
      $for code in tfa_recovery_codes:
        <li>${code}</li>
    </ol>
    <p>
      These codes are one-time use, and upon successful use will not be able to be reused or retrieved.
      If and when used, mark each code off. Codes may be used in any order.
    </p>
    <label for="tfa-init-verify">Enter 2FA token</label>
    <input type="text" id="tfa-init-verify" maxlength="7" name="tfaresponse" placeholder="012345" autocomplete="off" required /><br />
    <label><input class="checkbox" type="checkbox" name="verify" required /> I have printed or saved the above recovery codes and want to enable 2FA.</label>

    <input type="hidden" value="${','.join(tfa_recovery_codes)}" name="tfarecoverycodes" />
    <input type="hidden" value="${tfa_secret}" name="tfasecret" />
    $:{CSRF()}

    <div style="padding-top: 1em;">
      <a class="button negative" href="/control/2fa/status">Cancel</a>
      <button class="button positive" name="action" value="enable">Enable 2FA</button>
    </div>
  </form>
</div>
