FROM weasyl-app

ADD . /weasyl-src
RUN mkdir -p /var/cache/weasyl/.local
RUN chown -R weasyl: /weasyl-src /var/cache/weasyl/.local
RUN as-weasyl pip install --no-index -f /wheelhouse \
    -e /weasyl-src \
    -e '/weasyl-src/libweasyl[development]' \
    -e /weasyl-src/_wzl

ENV WEASYL_TEST_SQLALCHEMY_URL=postgres://postgres:postgres@db/weasyl_test
ENV WEASYL_RELOAD_TEMPLATES=y
ENV WEASYL_RELOAD_ASSETS=y
